<!DOCTYPE html>
<head>
  <title>Projects</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>Your Projects</h1>

  <h2>Create Project</h2>
  <form id="create-project-form">
    <label for="title">Name:</label><br>
    <input type="text" id="title" name="title"><br>
    <label for="description">Description:</label><br>
    <textarea id="description" name="description"></textarea><br>
    <input type="submit" value="Create">
  </form>
  

  <% if (projects.length > 0) { %>
  <ul>
    <% projects.forEach(function(project) { %>
    <li>
      <h2><%= project.title %></h2>
      <p><%= project.description %></p>
      <button class="update-project-button" data-id="<%= project.id %>">Update</button>
      <button class="delete-project-button" data-id="<%= project.id %>">Delete</button>
      <br>
      <section>
        <h2>Project Users</h2>
        <ul id="project-users">
          <% users.forEach(function(user) { %>
            <li><%= user.id %> - <%= user.name %></li>         
          <% }); %>
        </ul>
      </section>
      <br>
      <!-- Form to add a user to the project -->
      <form action="/projects/<%= project.id %>/users" method="POST">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" required>
        <input type="submit" value="Add User">
      </form>

      <!-- Form to remove a user from the project -->
      <form id="delete-user-form" action="/projects/<%= project.id %>/users" method="POST">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" required>
        <input type="submit" value="Remove User">
      </form>
    </li>
    <% }); %>
  </ul>
  <% } else { %>
  <p>No projects found.</p>
  <% } %>
  
  
  <script>
    $('#create-project-form').submit(function(e) {
      e.preventDefault();
      const title = $('#title').val();
      const content = $('#description').val();

      $.post('/projects', { title, content }, function(data) {
        // Refresh the page to see the new project
        location.reload();
      });
    });

    $('.update-project-button').click(function() {
      const id = $(this).data('id');
      const title = prompt('Enter new title');
      const content = prompt('Enter new content');
      $.ajax({
      url: '/projects/' + id,
      type: 'PUT',
      data: { title, content },
      success: function(data) {
      // Refresh the page to see the updated project
       location.reload();
      }
     });
    });
      

    $('.delete-project-button').click(function() {
      const id = $(this).data('id');
      $.ajax({
        url: '/projects/' + id,
        type: 'DELETE',
        success: function(data) {
          // Refresh the page to see the project removed
          location.reload();
        }
      });
    });
    
    $('#delete-user-form').submit(function(e) {
    e.preventDefault();

    const userId = $('#userId').val();
    const projectId = '<%= project.id %>';

    $.ajax({
      url: '/projects/' + projectId + '/users',
      type: 'DELETE',
      data: { userId: userId },
      success: function(data) {
        // Refresh the page to see the updated user list
        location.reload();
      },
      error: function(error) {
        console.error('Error:', error);
      }
    });
  });
  </script>
</body>
</html>